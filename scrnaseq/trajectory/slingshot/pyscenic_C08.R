library(tidyverse)
library(Seurat)
library(SeuratData)
library(patchwork)
library(cowplot)
library(clustree)
library(slingshot)
library(tradeSeq)
options(Seurat.object.assay.version = "v5")
options(future.globals.maxSize = 1e12)
setwd("/nemo/lab/caladod/working/Matthew/project/anqi/20230719_SC22272")

load("data/14_slingshot/14_slingshot_objects.Rdata")

mat2 <- read.csv("/camp/home/hungm/working/Matthew/project/anqi/20230719_SC22272/data/16_pyscenic/auc_mtx_zscore_unintegrated.csv", row.names = 1)
colnames(mat2) <- gsub("\\.1", "-1", colnames(mat2))
colnames(mat2) <- gsub("\\.2", "-2", colnames(mat2))
mat2 <- t(mat2)
rownames(mat2) <- gsub("_\\.\\.\\.", "(+)", rownames(mat2))

set.seed(5)
cells_keep <- meta.data %>% filter(!is.na(C08_pseudotime)) %>% rownames(.)
counts <- as.matrix(mat2[, cells_keep])
png("figures/16_pyscenic_unintegrated/pyscenic_C08_knots.png", width = 1500*5, height = 500*5, res = 78*5)
icMat <- evaluateK(counts = counts, pseudotime = pseudotime[cells_keep,3], cellWeights = cell.weights[cells_keep,3], k = 3:20, nGenes = 100, verbose = T, parallel = TRUE)
dev.off()
