.libPaths("/nemo/lab/caladod/working/Matthew/.conda/envs/slingshot/lib/R/library")
# load R libraries
library(tidyverse)
library(Seurat)
library(SeuratData)
library(patchwork)
library(cowplot)
library(clustree)
library(slingshot)
library(tradeSeq)
library(pheatmap)
library(zoo)
library(ComplexHeatmap)
options(Seurat.object.assay.version = "v5")
options(future.globals.maxSize = 1e12)
setwd("/nemo/lab/caladod/working/Matthew/project/anqi/20230719_SC22272")

load("data/14_slingshot/14_slingshot_objects.Rdata")

set.seed(5)
cellWeights <- slingCurveWeights(curves)
cells_keep1 <- meta.data %>% filter(!is.na(C05_pseudotime)) %>% rownames(.)
cells_keep2 <- meta.data %>% filter(!is.na(C08_pseudotime)) %>% rownames(.)
cells_keep3 <- meta.data %>% filter(!is.na(C07_pseudotime)) %>% rownames(.)
counts <- as.matrix(counts.matrix[, c(cells_keep1, cells_keep2, cells_keep3)])
sce <- fitGAM(counts = as.matrix(counts), pseudotime = pseudotime[c(cells_keep1, cells_keep2, cells_keep3), c(6,3,1)], cellWeights = cellWeights[c(cells_keep1, cells_keep2, cells_keep3), c(6,3,1)], nknots = 7)
save(sce, file = "data/14_slingshot/Between_lineages_fitgam.Rdata")
